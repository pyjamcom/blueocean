{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "questions.schema.json",
  "type": "object",
  "additionalProperties": false,
  "required": ["id", "prompt_image", "answers", "correct_index", "category"],
  "properties": {
    "id": {"type": "string", "minLength": 1},
    "category": {
      "type": "string",
      "enum": [
        "visual_provocation",
        "telepath_sync",
        "drunk_reflex",
        "absurd_sum",
        "face_mimic",
        "icon_battle",
        "sound_pantomime",
        "absurd_toast",
        "silhouette_guess",
        "trophy_rewards"
      ]
    },
    "prompt_image": {"$ref": "#/$defs/assetRef"},
    "answers": {
      "type": "array",
      "minItems": 4,
      "maxItems": 4,
      "items": {"$ref": "#/$defs/answer"}
    },
    "correct_index": {"type": "integer", "minimum": 0, "maximum": 3},
    "humor_tag": {"type": "string"},
    "duration_ms": {"type": "integer", "minimum": 1000},
    "season": {"type": "string"},
    "audio_hint": {"type": "string"},
    "audio_asset_id": {"$ref": "#/$defs/assetId"},
    "face_overlay_ids": {
      "type": "array",
      "minItems": 1,
      "items": {"$ref": "#/$defs/assetId"}
    },
    "prompt_pair_ids": {
      "type": "array",
      "minItems": 2,
      "items": {"$ref": "#/$defs/assetId"}
    },
    "trigger_asset_id": {"$ref": "#/$defs/assetId"},
    "trophy_stamp_id": {"$ref": "#/$defs/assetId"}
  },
  "allOf": [
    {
      "if": {"properties": {"category": {"const": "sound_pantomime"}}},
      "then": {"required": ["audio_asset_id"]}
    },
    {
      "if": {"properties": {"category": {"const": "face_mimic"}}},
      "then": {"required": ["face_overlay_ids"]}
    },
    {
      "if": {"properties": {"category": {"const": "absurd_sum"}}},
      "then": {"required": ["prompt_pair_ids"]}
    },
    {
      "if": {"properties": {"category": {"const": "drunk_reflex"}}},
      "then": {"required": ["trigger_asset_id"]}
    },
    {
      "if": {"properties": {"category": {"const": "trophy_rewards"}}},
      "then": {"required": ["trophy_stamp_id"]}
    }
  ],
  "$defs": {
    "assetId": {"type": "string", "pattern": "^[0-9]+$"},
    "url": {"type": "string", "format": "uri"},
    "assetRef": {
      "anyOf": [
        {"$ref": "#/$defs/assetId"},
        {"$ref": "#/$defs/url"}
      ]
    },
    "answer": {
      "type": "object",
      "additionalProperties": false,
      "required": ["id", "tags"],
      "properties": {
        "id": {"type": "string", "minLength": 1},
        "asset_id": {"$ref": "#/$defs/assetId"},
        "image_url": {"$ref": "#/$defs/url"},
        "tags": {"type": "array", "minItems": 1, "items": {"type": "string"}}
      },
      "anyOf": [
        {"required": ["asset_id"]},
        {"required": ["image_url"]}
      ]
    }
  }
}
